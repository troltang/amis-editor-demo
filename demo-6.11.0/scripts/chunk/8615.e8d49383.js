"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[8615],{58615:function(e,t,n){n.r(t),n.d(t,{TreeSelectControlRenderer:function(){return c},default:function(){return h}});var o=n(31635),i=n(96540),r=n(62758),a=n(71121),l=n(51545),s=n(38221),d=n.n(s),p=n(40961),u=n(66283),h=function(e){function t(t){var n=e.call(this,t)||this;return n.container=i.createRef(),n.input=i.createRef(),n.cache={},n.targetRef=function(e){return n.target=e?(0,p.findDOMNode)(e):null},n.sourceLoaded=!1,n.state={inputValue:"",tempValue:"",isOpened:!1},n.open=n.open.bind(n),n.close=n.close.bind(n),n.handleChange=n.handleChange.bind(n),n.handleTempChange=n.handleTempChange.bind(n),n.handleConfirm=n.handleConfirm.bind(n),n.clearValue=n.clearValue.bind(n),n.handleFocus=n.handleFocus.bind(n),n.handleBlur=n.handleBlur.bind(n),n.handleKeyPress=n.handleKeyPress.bind(n),n.handleInputChange=d()(n.handleInputChange.bind(n),150,{trailing:!0,leading:!1}),n.handleInputKeyDown=n.handleInputKeyDown.bind(n),n.loadRemote=d()(n.loadRemote.bind(n),250,{trailing:!0,leading:!1}),n}return(0,o.C6)(t,e),t.prototype.componentDidMount=function(){this.loadRemote("")},t.prototype.componentWillUnmount=function(){this.sourceLoaded=!1},t.prototype.open=function(e){this.props.disabled||this.setState({isOpened:!0},e)},t.prototype.close=function(){var e=this;this.setState({isOpened:!1,inputValue:this.props.multiple?this.state.inputValue:""},(function(){return e.loadRemote(e.state.inputValue)}))},t.prototype.resolveOptions=function(){var e=this.props,t=e.options,n=e.searchable,o=e.autoComplete;return!(0,r.Amo)(o)&&n&&this.state.inputValue?this.filterOptions(t,this.state.inputValue):t},t.prototype.resolveOption=function(e,t){var n=this;return(0,r.cym)(e,(function(e){var o=n.props.valueField||"value";return((0,r.Bdw)(e,o)?e[o]:"")===t}))},t.prototype.handleFocus=function(e){var t=this.props,n=t.dispatchEvent,o=t.value,i=this.resolveOptions(),a=this.resolveOption(i,o);n("focus",(0,r.RKM)(this.props,{value:o,item:a,items:i}))},t.prototype.handleBlur=function(e){var t=this.props,n=t.dispatchEvent,o=t.value,i=this.resolveOptions(),a=this.resolveOption(i,o);n("blur",(0,r.RKM)(this.props,{value:o,item:a,items:i}))},t.prototype.handleKeyPress=function(e){" "===e.key&&e.shiftKey&&(this.handleOutClick(e),e.preventDefault())},t.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,o=e.maxLength,i=e.delimiter,r=Array.isArray(t)?t:(t?String(t):"").split(i||",");return n&&r.length<n?"已选择数量低于设定的最小个数".concat(n,"，请选择更多的选项。"):o&&r.length>o?"已选择数量超出设定的最大个数".concat(o,"，请取消选择超出的选项。"):void 0},t.prototype.removeItem=function(e,t){var n=this.props,o=n.selectedOptions,i=n.joinValues,r=n.extractValue,a=n.delimiter,l=n.valueField,s=n.onChange,d=n.disabled;if(t&&t.stopPropagation(),!d){var p=o.concat();p.splice(e,1);var u=p;i?u=p.map((function(e){return e[l||"value"]})).join(a||","):r&&(u=p.map((function(e){return e[l||"value"]}))),s(u)}},t.prototype.handleChange=function(e){var t=this;this.props.multiple||this.close(),this.setState({inputValue:""},(function(){return t.resultChangeEvent(e)}))},t.prototype.handleTempChange=function(e){this.setState({tempValue:e})},t.prototype.handleConfirm=function(){var e=this;this.close(),this.setState({inputValue:""},(function(){return e.resultChangeEvent(e.state.tempValue)}))},t.prototype.handleInputChange=function(e){var t=this,n=this.props,o=n.autoComplete,i=n.data;this.setState({inputValue:e},(0,r.Amo)(o,i)?function(){return t.loadRemote(t.state.inputValue)}:void 0)},t.prototype.handleInputKeyDown=function(e){var t=this.state.inputValue,n=this.props,o=n.multiple,i=n.selectedOptions;"Backspace"===e.key&&!t&&i.length&&o&&this.removeItem(i.length-1)},t.prototype.resetValue=function(){var e,t,n=this.props,o=n.onChange,i=n.resetValue,a=n.formStore,l=n.store,s=n.name;o(null!==(t=(0,r.dnO)(null!==(e=null==a?void 0:a.pristine)&&void 0!==e?e:null==l?void 0:l.pristine,s))&&void 0!==t?t:i)},t.prototype.clearValue=function(){var e=this.props,t=e.onChange,n=e.resetValue;t(void 0===n?"":n)},t.prototype.filterOptions=function(e,t){var n=this,i=this.props,r=i.labelField,a=i.valueField;return e.map((function(e){if((e=(0,o.Cl)({},e)).visible=!!(0,l.Ht)([e],t,{keys:[r||"label",a||"value"],threshold:l.Ht.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=n.filterOptions(e.children,t);var i=e.children.filter((function(e){return e.visible})).length;e.visible=!!i}return e.visible&&(e.collapsed=!1),e}))},t.prototype.loadRemote=function(e){return(0,o.sH)(this,void 0,void 0,(function(){var t,n,i,a,l,s,d,p,u,h;return(0,o.YH)(this,(function(c){switch(c.label){case 0:if(t=this.props,n=t.autoComplete,i=t.env,a=t.data,l=t.setOptions,s=t.setLoading,d=t.source,!(0,r.Amo)(n,a)||!e&&(0,r.Amo)(d)&&!this.sourceLoaded)return this.sourceLoaded=!0,[2];if(!i||!i.fetcher)throw new Error("fetcher is required");if(this.cache[e]||~e.indexOf("'"))return u=this.cache[e]||[],h=this.mergeOptions(u),l(h),[2,Promise.resolve({options:h})];s(!0),c.label=1;case 1:return c.trys.push([1,,3,4]),[4,i.fetcher(n,(0,o.Cl)((0,o.Cl)({},a),{term:e,value:e}))];case 2:return p=c.sent(),u=p.data&&p.data.options||p.data||[],this.cache[e]=u,h=this.mergeOptions(u),l(h),[2,{options:h}];case 3:return s(!1),[7];case 4:return[2]}}))}))},t.prototype.mergeOptions=function(e){var t=this.props.selectedOptions,n=(0,r.a5s)(e).concat();return Array.isArray(t)&&t.length&&t.forEach((function(e){(0,r.cym)(n,(function(t){return t.value==e.value}))||n.push((0,o.Cl)({},e))})),n},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.handleOutClick=function(e){e.defaultPrevented||this.setState({isOpened:!0})},t.prototype.handleResultChange=function(e){var t=this.props,n=t.joinValues,o=t.extractValue,i=t.delimiter,r=t.valueField,a=t.multiple,l=Array.isArray(e)?e.concat():[];a||l.length?((n||o)&&(l=e.map((function(e){return e[r||"value"]}))),n&&(l=l.join(i||",")),this.resultChangeEvent(l)):this.resultChangeEvent("")},t.prototype.doAction=function(e,t,n){var o,i,r,a,l;"clear"===e.actionType?this.clearValue():"reset"===e.actionType?this.resetValue():"add"===e.actionType?this.addItemFromAction(null===(o=e.args)||void 0===o?void 0:o.item,null===(i=e.args)||void 0===i?void 0:i.parentValue):"edit"===e.actionType?this.editItemFromAction(null===(r=e.args)||void 0===r?void 0:r.item,null===(a=e.args)||void 0===a?void 0:a.originValue):"delete"===e.actionType?this.deleteItemFromAction(null===(l=e.args)||void 0===l?void 0:l.value):"reload"===e.actionType&&this.reload()},t.prototype.addItemFromAction=function(e,t){var n=this.props,o=n.onAdd,i=n.options,a=n.valueField,l=(0,r.iXH)(i,(function(e){var n=a||"value";return((0,r.Bdw)(e,n)?e[n]:"")===t}))||[];o&&o(l.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var n=this.props,i=n.onEdit,r=n.options,a=this.resolveOption(r,t);i&&a&&i((0,o.Cl)((0,o.Cl)({},e),{originValue:t}),a,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,o=t.options,i=this.resolveOption(o,e);n&&i&&n(i)},t.prototype.resultChangeEvent=function(e){return(0,o.sH)(this,void 0,void 0,(function(){var t,n,i,a,l,s;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return t=this.props,n=t.onChange,i=t.dispatchEvent,a=this.resolveOptions(),l=this.resolveOption(a,e),[4,i("change",(0,r.RKM)(this.props,{value:e,item:l,items:this.resolveOptions()}))];case 1:return(null==(s=o.sent())?void 0:s.prevented)||n&&n(e),[2]}}))}))},t.prototype.handleNodeClick=function(e){return(0,o.sH)(this,void 0,void 0,(function(){var t,n,i,a;return(0,o.YH)(this,(function(o){switch(o.label){case 0:return t=this.props,n=t.dispatchEvent,i=t.data,[4,n("itemClick",(0,r.ed2)(i,{item:e}))];case 1:return null==(a=o.sent())||a.prevented,[2]}}))}))},t.prototype.renderOptionItem=function(e,t){var n=this.props,i=n.menuTpl,a=n.render,l=n.data;return a("option/".concat(t.index),i,{data:(0,r.ed2)((0,r.ed2)(l,(0,o.Cl)({},t)),e)})},t.prototype.renderItem=function(e){var t=this.props,n=t.labelField,o=t.options;if(t.hideNodePathLabel)return e[n||"label"];var i=(0,r.fw2)(o,e,!0);return"".concat(i?i.map((function(e){return"".concat(e[n||"label"])})).join(" / "):e[n||"label"])},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.renderOuter=function(){var e=this.props,t=e.value,n=e.enableNodePath,l=e.pathSeparator,s=void 0===l?"/":l,d=e.disabled,p=e.joinValues,u=e.extractValue,h=e.delimiter,c=(e.placeholder,e.options),m=e.multiple,v=e.valueField,f=e.initiallyOpen,g=e.unfoldedLevel,y=e.withChildren,C=e.rootLabel,b=e.cascade,O=e.rootValue,S=e.showIcon,I=e.showRadio,V=(e.popOverContainer,e.onlyChildren),F=e.onlyLeaf,T=e.classPrefix,A=e.optionsPlaceholder,w=e.searchable,R=e.autoComplete,P=e.maxLength,E=e.minLength,j=e.labelField,k=e.deferField,x=e.nodePath,D=e.onAdd,L=e.creatable,N=e.createTip,H=e.addControls,K=e.onEdit,B=e.editable,M=e.editTip,U=e.editControls,z=e.removable,_=e.removeTip,W=e.onDelete,Y=e.rootCreatable,q=e.rootCreateTip,J=e.translate,Q=e.deferLoad,X=e.expandTreeOptions,$=e.selfDisabledAffectChildren,G=e.showOutline,Z=e.autoCheckChildren,ee=e.autoCancelParent,te=e.hideRoot,ne=e.virtualThreshold,oe=e.itemHeight,ie=e.menuTpl,re=e.enableDefaultIcon,ae=e.mobileUI,le=e.testIdBuilder,se=e.nodeBehavior,de=e.itemActions,pe=e.classnames,ue=e.id,he=e.themeCss,ce=!(0,r.Amo)(R)&&w&&this.state.inputValue?this.filterOptions(c,this.state.inputValue):c;return i.createElement(a.PH,{classPrefix:T,onRef:this.domRef,onlyChildren:V,onHandleNodeClick:this.handleNodeClick,onlyLeaf:F,labelField:j,valueField:v,deferField:k,disabled:d,onChange:ae?this.handleTempChange:this.handleChange,joinValues:p,extractValue:u,delimiter:h,placeholder:J(A),options:ce,highlightTxt:this.state.inputValue,multiple:m,initiallyOpen:f,unfoldedLevel:g,withChildren:y,autoCheckChildren:Z,autoCancelParent:ee,rootLabel:J(C),rootValue:O,showIcon:S,showRadio:I,showOutline:G,cascade:b,foldedField:"collapsed",hideRoot:te,value:t||"",nodePath:x,enableNodePath:n,pathSeparator:s,maxLength:P,minLength:E,onAdd:D,creatable:L,createTip:N,rootCreatable:Y,rootCreateTip:q,onEdit:K,editable:B,editTip:M,removable:z,removeTip:_,onDelete:W,bultinCUD:!H&&!U,onDeferLoad:Q,onExpandTree:X,selfDisabledAffectChildren:$,virtualThreshold:ne,itemHeight:(0,r.Roz)(oe)>0?(0,r.Roz)(oe):void 0,itemRender:ie?this.renderOptionItem:void 0,enableDefaultIcon:re,mobileUI:ae,nodeBehavior:se,itemActionsRender:de?this.renderItemActions:void 0,actionClassName:pe((0,r.NH8)((0,o.Cl)((0,o.Cl)({},this.props),{name:"actionControlClassName",id:ue,themeCss:he}))),testIdBuilder:le})},t.prototype.renderItemActions=function(e,t){var n=this.props,i=n.itemActions,a=n.data;return(0,n.render)("action/".concat(t.index),i||"",{data:(0,r.ed2)((0,r.ed2)(a,(0,o.Cl)({},t)),e)})},t.prototype.render=function(){var e=this,t=this.props,n=t.className,l=(t.style,t.disabled),s=t.inline,d=t.loading,p=t.multiple,u=(t.value,t.clearable),h=t.classPrefix,c=t.classnames,m=t.searchable,v=t.autoComplete,f=t.selectedOptions,g=t.placeholder,y=t.popOverContainer,C=t.mobileUI,b=t.maxTagCount,O=t.overflowTagPopover,S=t.translate,I=t.env,V=t.loadingConfig,F=t.testIdBuilder,T=t.wrapperCustomStyle,A=t.id,w=t.themeCss,R=this.state.isOpened,P=p?f:f.length?this.renderItem(f[0]):"";return i.createElement(i.Fragment,null,i.createElement("div",(0,o.Cl)({ref:this.container,className:c("TreeSelectControl",n)},null==F?void 0:F.getTestId()),i.createElement(a.dM,{popOverContainer:y||I.getModalContainer,maxTagCount:b,overflowTagPopover:O,disabled:l,ref:this.targetRef,placeholder:S(null!=g?g:"placeholder.empty"),inputPlaceholder:"",className:c("TreeSelect",{"TreeSelect--inline":s,"TreeSelect--single":!p,"TreeSelect--multi":p,"TreeSelect--searchable":m||(0,r.Amo)(v),"is-opened":this.state.isOpened,"is-disabled":l}),result:P,onResultClick:this.handleOutClick,value:this.state.inputValue,onChange:this.handleInputChange,onResultChange:this.handleResultChange,itemRender:this.renderItem,onKeyPress:this.handleKeyPress,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleInputKeyDown,clearable:u,allowInput:!C&&(m||(0,r.Amo)(v))&&(p||!P),hasDropDownArrow:!0,readOnly:C,mobileUI:C,testIdBuilder:null==F?void 0:F.getChild("result-box")},d?i.createElement(a.y$,{loadingConfig:V,size:"sm"}):void 0),!C&&R?i.createElement(r.hJs,{container:y||function(){return e.container.current},target:function(){return e.target},show:!0},i.createElement(r.Kx3,{classPrefix:h,className:"".concat(h,"TreeSelect-popover"),style:{minWidth:this.target?this.target.offsetWidth:void 0},onHide:this.close,overlay:!0},this.renderOuter())):null,C?i.createElement(a.HH,{container:I.getModalContainer,className:c("".concat(h,"TreeSelect-popup")),isShow:R,onHide:this.close,showConfirm:!0,onConfirm:this.handleConfirm},this.renderOuter()):null),i.createElement(r.z4D,(0,o.Cl)({},this.props,{config:{wrapperCustomStyle:T,id:A,themeCss:w,classNames:[{key:"actionControlClassName"}]},env:I})))},t.defaultProps={hideRoot:!0,placeholder:"Select.placeholder",optionsPlaceholder:"placeholder.noData",multiple:!1,clearable:!0,rootLabel:"Tree.root",rootValue:"",showIcon:!0,joinValues:!0,extractValue:!1,delimiter:",",resetValue:"",hideNodePathLabel:!1,enableNodePath:!1,pathSeparator:"/",selfDisabledAffectChildren:!0},(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleOutClick",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Array]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"handleResultChange",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",Promise)],t.prototype,"resultChangeEvent",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",Promise)],t.prototype,"handleNodeClick",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"renderItem",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"domRef",null),(0,o.Cg)([r.d6t,(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[Object,Object]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"renderItemActions",null),(0,o.Cg)([(0,u.E)(),(0,o.Sn)("design:type",Function),(0,o.Sn)("design:paramtypes",[]),(0,o.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(i.Component),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.C6)(t,e),(0,o.Cg)([(0,r.QqA)({type:"tree-select"})],t)}(h)}}]);