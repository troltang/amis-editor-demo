"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[4455],{94455:function(t,e,n){n.r(e),n.d(e,{TableControlRenderer:function(){return b},default:function(){return v}});var i=n(31635),a=n(96540),s=n(62758),r=n(71121),o=n(90179),l=n.n(o),d=n(7309),u=n.n(d),c=n(38221),h=n.n(c),p=n(95093),m=n.n(p),f="__isPlaceholder",v=function(t){function e(e){var n=t.call(this,e)||this;n.entityId=1,n.subForms={},n.subFormItems={},n.rowPrinstine=[],n.editting={},n.toDispose=[],n.lazyEmitValue=h()(n.emitValue.bind(n),50,{trailing:!0,leading:!1}),n.emittedValue=null;var a=e.addHook,r=Array.isArray(e.value)?e.value.concat():[];return n.state=(0,i.Cl)({columns:n.buildColumns(e),editIndex:"",items:r},n.transformState(r)),n.entries=new s.NH2,n.buildItemProps=n.buildItemProps.bind(n),n.confirmEdit=n.confirmEdit.bind(n),n.cancelEdit=n.cancelEdit.bind(n),n.handleSaveTableOrder=n.handleSaveTableOrder.bind(n),n.handleTableSave=n.handleTableSave.bind(n),n.handleRadioChange=n.handleRadioChange.bind(n),n.getEntryId=n.getEntryId.bind(n),n.subFormRef=n.subFormRef.bind(n),n.subFormItemRef=n.subFormItemRef.bind(n),n.handlePageChange=n.handlePageChange.bind(n),n.handleTableQuery=n.handleTableQuery.bind(n),n.emitValue=n.emitValue.bind(n),n.tableRef=n.tableRef.bind(n),n.flush=n.flush.bind(n),n.filterItemIndex=n.filterItemIndex.bind(n),a&&n.toDispose.push(a(n.flush,"flush")),n}return(0,i.C6)(e,t),e.prototype.componentDidUpdate=function(t,e){var n=this.props,a=null;if(t.disabled!==n.disabled||t.static!==n.static||n.$schema.disabled!==t.$schema.disabled||n.$schema.static!==t.$schema.static){var s=this.state.items.filter((function(t){return!t.hasOwnProperty(f)}));a=(0,i.Cl)((0,i.Cl)((0,i.Cl)((0,i.Cl)({},a),{items:s}),this.transformState(s)),{editIndex:"",columns:this.buildColumns(n)})}n.columns!==t.columns&&(a=(0,i.Cl)((0,i.Cl)({},a),{columns:this.buildColumns(n)})),n.value!==t.value&&n.value!==this.emittedValue&&(s=Array.isArray(n.value)?n.value.concat():[],a=(0,i.Cl)((0,i.Cl)((0,i.Cl)((0,i.Cl)({},a),{items:s}),this.transformState(s)),{editIndex:""})),a&&this.setState(a)},e.prototype.componentWillUnmount=function(){this.entries.dispose(),this.lazyEmitValue.cancel(),this.toDispose.forEach((function(t){return t()})),this.toDispose=[]},e.prototype.transformState=function(t,e,n){var a=this.props,r=a.perPage,o=a.matchFunc,l=(0,i.Cl)((0,i.Cl)({},this.state),e),d=l.query,u=l.page,c=null!=d?d:{},h=c.orderBy,p=c.orderDir,m=(0,i.Tt)(c,["orderBy","orderDir"]);Object.keys(m).length&&(t=(0,s.W5d)(t,{query:m,columns:this.state.columns,matchFunc:"string"==typeof o&&o?(0,s.sce)(o,"items","itemsRaw","options"):"function"==typeof o?o:void 0})),h&&(t=(0,s.ehs)(t.concat(),h,"string"==typeof p&&/desc/i.test(p)?-1:1));var f=t.length;if(u=Math.min(null!=u?u:1,"number"==typeof r?Math.max(1,Math.ceil(f/r)):1),n){var v=t.indexOf(n);~v&&(u=Math.ceil((v+1)/r))}return"number"==typeof r&&r&&t.length>r&&(t=t.slice((u-1)*r,u*r)),{filteredItems:t,page:u,total:f}},e.prototype.flush=function(){return(0,i.sH)(this,void 0,void 0,(function(){var t,e,n=this;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=[],Object.keys(this.subForms).forEach((function(e){return n.subForms[e]&&t.push(n.subForms[e])})),[4,Promise.all(t.map((function(t){return t.flush()})))];case 1:return i.sent(),e=[],Object.keys(this.subFormItems).forEach((function(t){return n.subFormItems[t]&&e.push(n.subFormItems[t])})),[4,Promise.all(e.map((function(t){var e,n;return null===(n=(e=t.props).onFlushChange)||void 0===n?void 0:n.call(e)})))];case 2:return i.sent(),[4,this.lazyEmitValue.flush()];case 3:return i.sent(),[2]}}))}))},e.prototype.resolveVariableProps=function(t,e){var n={minLength:0,maxLength:1/0},i=t[e];if(!i)return n[e];if("string"==typeof i)if((0,s.joH)(i)){var a=(0,s.GvO)(i,t.data,"| raw");i="number"==typeof a&&a>=0?a:n[e]}else{var r=parseInt(i,10);i=isNaN(r)?n[e]:r}return i},e.prototype.subFormRef=function(t,e,n){this.subForms["".concat(e,"-").concat(n)]=t},e.prototype.subFormItemRef=function(t,e,n){this.subFormItems["".concat(e,"-").concat(n)]=t},e.prototype.validate=function(){return(0,i.sH)(this,void 0,void 0,(function(){var t,e,n,a,r,o,l,d,u,c,h,p=this;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,e=t.value,n=t.translate,a=t.columns,r=this.resolveVariableProps(this.props,"minLength"),o=this.resolveVariableProps(this.props,"maxLength"),this.state.editIndex?[2,n("Table.editing")]:r&&(!Array.isArray(e)||e.length<r)?[2,n("Combo.minLength",{minLength:r})]:[3,1];case 1:return o&&Array.isArray(e)&&e.length>o?[2,n("Combo.maxLength",{maxLength:o})]:[3,2];case 2:return l=[],Object.keys(this.subForms).forEach((function(t){return p.subForms[t]&&l.push(p.subForms[t])})),l.length?[4,Promise.all(l.map((function(t){return t.validate()})))]:[3,4];case 3:if(d=i.sent(),u=~d.indexOf(!1)?n("Form.validateFailed"):"",c="",!u&&Array.isArray(a)&&Array.isArray(e)&&a.some((function(t){if(t.unique&&t.name){var n=[];return e.some((function(e){var i=(0,s.dnO)(e,t.name);return~n.indexOf(i)?(c="".concat(t.label||t.name),!0):(n.push(i),!1)}))}return!1}))&&(u=n("InputTable.uniqueError",{label:c})),u)return[2,u];i.label=4;case 4:return h=[],Object.keys(this.subFormItems).forEach((function(t){return p.subFormItems[t]&&h.push(p.subFormItems[t])})),[4,Promise.all(h.map((function(t){return t.props.onValidate()})))];case 5:return[2,~i.sent().indexOf(!1)?n("Form.validateFailed"):""]}}))}))},e.prototype.emitValue=function(t){return(0,i.sH)(this,void 0,void 0,(function(){var e,n,a;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return e=null!=t?t:this.state.items.filter((function(t){return!t.hasOwnProperty(f)})),n=this.props.onChange,[4,this.dispatchEvent("change")];case 1:return(a=i.sent())||(this.emittedValue=e,null==n||n(e)),[2,a]}}))}))},e.prototype.doAction=function(t,e){for(var n,a,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return(0,i.sH)(this,void 0,void 0,(function(){var o,l,d,c,h,p,m,v,b,y,I,C,g,x,w,E,P,R=this;return(0,i.YH)(this,(function(A){switch(A.label){case 0:return o=this.props,l=o.onAction,d=o.valueField,c=o.env,h=o.needConfirm,p=o.addable,m=o.addApi,v=o.translate,b=o.onChange,"add"!==(y=t.actionType)?[3,6]:!1===p?[2]:(I=this.state.items.concat(),m||t.payload?(C=null,(0,s.Amo)(m,e)?[4,c.fetcher(m,e)]:[3,2]):[3,4]);case 1:return(g=A.sent())&&!g.ok?(!(null==m?void 0:m.silent)&&c.notify("error",null!==(a=null===(n=null==m?void 0:m.messages)||void 0===n?void 0:n.failed)&&void 0!==a?a:g.msg||v("fetchFailed")),[2]):(g&&g.ok&&(C=g.data),[3,3]);case 2:C=(0,s.nd1)(t.payload,e),A.label=3;case 3:return(C=Array.isArray(C)?C:[C]).forEach((function(t){d&&u()(I,(function(e){return e[d]==t[d]}))||(I.push(t),!1!==h&&Reflect.set(t,f,!0))})),this.setState((0,i.Cl)({items:I},this.transformState(I)),(function(){1===C.length&&!1!==h?R.startEdit("".concat(I.length-1),!0):null==b||b(I)})),[2];case 4:return[2,this.addItem("".concat(I.length-1),!1)];case 5:return[3,7];case 6:if("remove"===y||"delete"===y)return d?t.payload?(x=this.state.items.concat(),w=(0,s.nd1)(t.payload,e),(w=Array.isArray(w)?w:[w]).forEach((function(t){var e=(0,s.iXH)(x,(function(e){return e[d]==t[d]}));(null==e?void 0:e.length)&&(x=(0,s.Z6D)(x,e,1))})),this.setState((0,i.Cl)({items:x},this.transformState(x)),(function(){null==b||b(x)})),[2]):[2,c.alert(v("Table.playload"))]:[2,c.alert(v("Table.valueField"))];"initDrag"===y?(E=this.table).doAction.apply(E,(0,i.fX)([t,e],(0,i.zs)(r),!1)):"cancelDrag"===y&&(P=this.table).doAction.apply(P,(0,i.fX)([t,e],(0,i.zs)(r),!1)),A.label=7;case 7:return[2,l&&l.apply(void 0,(0,i.fX)([t,e],(0,i.zs)(r),!1))]}}))}))},e.prototype.copyItem=function(t){return(0,i.sH)(this,void 0,void 0,(function(){var e,n,a,r,o,l,d,u,c,h,p,m,v,b,y,I,C=this;return(0,i.YH)(this,(function(g){return e=this.props,n=e.needConfirm,a=e.data,r=e.copyData,o=void 0===r?{"&":"$$"}:r,l=this.state.items.concat(),d=t.split(".").map((function(t){return parseInt(t,10)})),(u=d.concat())[u.length-1]+=1,c=l,h=(0,s.Jvj)(l,d),p=(0,s.nd1)(o,(0,s.ed2)(a,h)),l=!1===n?(0,s.Z6D)(l,u,0,p):(0,s.Z6D)(l,u,0,(0,i.Cl)((0,i.Cl)({},p),((I={})[f]=!0,I))),this.reUseRowId(l,c,u),m=l[u[0]],(v=(0,i.Cl)((0,i.Cl)({},this.transformState(l)),{items:l})).filteredItems.includes(m)||(b=l[d[0]],y=v.filteredItems.findIndex((function(t){return t===b})),v.filteredItems.splice(y+1,0,m)),this.setState(v,(function(){return(0,i.sH)(C,void 0,void 0,(function(){return(0,i.YH)(this,(function(t){switch(t.label){case 0:return[4,this.dispatchEvent("add",{index:u[u.length-1],indexPath:u.join("."),item:p})];case 1:return t.sent()||(!1===n?this.emitValue():this.startEdit(u.join("."),!0)),[2]}}))}))})),[2]}))}))},e.prototype.addItem=function(t,e,n){return void 0===e&&(e=!0),(0,i.sH)(this,void 0,void 0,(function(){var a,r,o,l,d,u,c,h,p,v,b,y,I,C,g,x=this;return(0,i.YH)(this,(function(w){return t=t||"".concat(this.state.items.length-1),a=this.props,r=a.needConfirm,o=a.scaffold,l=a.columns,d=a.data,a.perPage,u=this.state.items.concat(),(g={})[f]=!0,c=g,Array.isArray(l)&&l.forEach((function(t){if(void 0!==t.value&&"string"==typeof t.name)if(!("type"in t)||"input-date"!==t.type&&"input-datetime"!==t.type&&"input-time"!==t.type&&"input-month"!==t.type&&"input-quarter"!==t.type&&"input-year"!==t.type)(0,s.BHS)(t.value)||(0,s.BBb)(c,t.name,t.value);else if("string"!=typeof t.value||""!==t.value.trim()){var e=(0,s.PO2)(t.value,d,t.format||"X");(0,s.BBb)(c,t.name,(t.utc?m().utc(e):e).format(t.format||"X"))}})),c=(0,i.Cl)((0,i.Cl)({},c),o),!1===r&&Reflect.deleteProperty(c,f),h=t.split(".").map((function(t){return parseInt(t,10)})),(p=h.concat())[p.length-1]+=1,v=u,u=(0,s.Z6D)(u,p,0,c),this.reUseRowId(u,v,p),b=u[p[0]],(y=(0,i.Cl)((0,i.Cl)({items:u},this.transformState(u,void 0,b)),!1===r?{}:{editIndex:p.join("."),isCreateMode:!0,columns:this.buildColumns(this.props,!0,"".concat(t))})).filteredItems.includes(b)||(I=u[h[0]],C=y.filteredItems.findIndex((function(t){return t===I})),y.filteredItems.splice(C+1,0,b)),this.setState(y,(function(){return(0,i.sH)(x,void 0,void 0,(function(){return(0,i.YH)(this,(function(t){switch(t.label){case 0:return e?[4,this.dispatchEvent("add",{index:p[p.length-1],indexPath:p.join("."),item:c})]:[3,2];case 1:t.sent(),t.label=2;case 2:return!1===r&&this.emitValue(),null==n||n(),[2]}}))}))})),[2,!1]}))}))},e.prototype.subAddItem=function(t,e,n){return void 0===e&&(e=!0),(0,i.sH)(this,void 0,void 0,(function(){return(0,i.YH)(this,(function(i){return[2,this.addItem(t+".-1",e,(function(){null==n||n.setExpanded(!0)}))]}))}))},e.prototype.editItem=function(t){return(0,i.sH)(this,void 0,void 0,(function(){var e,n,a;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return e=this.state.items,n=t.split(".").map((function(t){return parseInt(t,10)})),a=(0,s.Jvj)(e,n),[4,this.dispatchEvent("edit",{index:n[n.length-1],indexPath:n.join("."),item:a})];case 1:return!i.sent()&&this.startEdit(t,!0),[2]}}))}))},e.prototype.dispatchEvent=function(t,e){return void 0===e&&(e={}),(0,i.sH)(this,void 0,void 0,(function(){var n,a,r,o,l;return(0,i.YH)(this,(function(d){switch(d.label){case 0:return n=this.props.dispatchEvent,a=this.state,r=a.items,o=a.rowIndex,[4,n(t,(0,s.RKM)(this.props,(0,i.Cl)({value:(0,i.fX)([],(0,i.zs)(r),!1),rowIndex:o},e)))];case 1:return[2,!!(null==(l=d.sent())?void 0:l.prevented)]}}))}))},e.prototype.startEdit=function(t,e){void 0===e&&(e=!1),this.setState({editIndex:t,isCreateMode:e,columns:this.buildColumns(this.props,e,t)})},e.prototype.confirmEdit=function(){var t,e,n;return(0,i.sH)(this,void 0,void 0,(function(){var a,r,o,l,d,u,c,h,p,m,v,b,y,I,C,g,x,w,E=this;return(0,i.YH)(this,(function(P){switch(P.label){case 0:return a=this.props,r=a.addApi,o=a.updateApi,l=a.data,d=a.env,u=a.translate,c=[],Object.keys(this.subForms).forEach((function(t){return E.subForms[t]&&c.push(E.subForms[t])})),c.forEach((function(t){return t.flush()})),h=[],Object.keys(this.subFormItems).forEach((function(t){return E.subFormItems[t]&&h.push(E.subFormItems[t])})),h.forEach((function(t){var e,n;return null===(n=(e=t.props).onFlushChange)||void 0===n?void 0:n.call(e)})),p=c,[4,Promise.all(p.map((function(t){return t.validate()})).concat(h.map((function(t){return t.props.onValidate()}))))];case 1:return~P.sent().indexOf(!1)?[2]:(m=this.state.items.concat(),v=this.state.editIndex.split(".").map((function(t){return parseInt(t,10)})),b=(0,i.Cl)({},(0,s.Jvj)(m,v)),y=b.hasOwnProperty(f),I=y?"addConfirm":"editConfirm",[4,this.dispatchEvent(I,{index:v[v.length-1],indexPath:v.join("."),item:b})]);case 2:return P.sent()?[2]:(C=null,g=void 0,y&&(0,s.Amo)(r,(0,s.ed2)(l,b))?[4,d.fetcher(r,(0,s.ed2)(l,b))]:[3,4]);case 3:return C=P.sent(),g=null===(t=null==r?void 0:r.messages)||void 0===t?void 0:t.failed,[3,6];case 4:return y||!(0,s.Amo)(o,(0,s.ed2)(l,b))?[3,6]:[4,d.fetcher(o,(0,s.ed2)(l,b))];case 5:C=P.sent(),g=null===(e=null==o?void 0:o.messages)||void 0===e?void 0:e.failed,P.label=6;case 6:return C&&!C.ok?(!(null===(n=y?r:o)||void 0===n?void 0:n.silent)&&d.notify("error",null!=g?g:C.msg||u("saveFailed")),x=y?"addFail":"editFail",this.dispatchEvent(x,{index:v[v.length-1],indexPath:v.join("."),item:b,error:C}),[2]):(C&&C.ok&&(b=(0,i.Cl)((0,i.Cl)({},(y?r:o).replaceData?{}:b),C.data)),Reflect.deleteProperty(b,f),w=m,m=(0,s.Z6D)(m,v,1,b),this.reUseRowId(m,w,v),this.setState((0,i.Cl)((0,i.Cl)({editIndex:"",items:m},this.transformState(m)),{columns:this.buildColumns(this.props)}),(function(){return(0,i.sH)(E,void 0,void 0,(function(){var t;return(0,i.YH)(this,(function(e){switch(e.label){case 0:return[4,this.emitValue()];case 1:return e.sent()||(t=y?"addSuccess":"editSuccess",this.dispatchEvent(t,{index:v[v.length-1],indexPath:v.join("."),item:b})),[2]}}))}))})),[2])}}))}))},e.prototype.cancelEdit=function(){var t=this.state.items.concat(),e=this.state.lastModifiedRow,n=this.state.editIndex.split(".").map((function(t){return parseInt(t,10)})),a=(0,i.Cl)({},(0,s.Jvj)(t,n)),r=t;a.hasOwnProperty(f)?t=(0,s.Z6D)(t,n,1):e&&~(null==e?void 0:e.index)&&(0,s.Gvm)(null==e?void 0:e.data)&&(t=(0,s.Z6D)(t,n,1,(0,i.Cl)((0,i.Cl)({},a),e.data))),this.reUseRowId(t,r,n),this.setState((0,i.Cl)((0,i.Cl)({editIndex:"",items:t},this.transformState(t)),{columns:this.buildColumns(this.props),lastModifiedRow:void 0}),this.emitValue)},e.prototype.removeItem=function(t){var e,n;return(0,i.sH)(this,void 0,void 0,(function(){var a,r,o,l,d,u,c,h,p,m,f,v,b,y=this;return(0,i.YH)(this,(function(I){switch(I.label){case 0:return a=this.props,r=a.value,a.onChange,o=a.deleteApi,l=a.deleteConfirmText,d=a.env,u=a.data,c=a.translate,h=Array.isArray(r)?r.concat():[],p=t.split(".").map((function(t){return parseInt(t,10)})),(m=(0,s.Jvj)(h,p))?[4,this.dispatchEvent("delete",{index:p[p.length-1],indexPath:p.join("."),item:m})]:[2];case 1:return I.sent()?[2]:(f=(0,s.ed2)(u,m),(0,s.Amo)(o,f)?[4,d.confirm(l?(0,s.pbD)(l,f):c("deleteConfirm"))]:[3,4]);case 2:return I.sent()?[4,d.fetcher(o,f)]:[2];case 3:if(!(v=I.sent()).ok)return!(null==o?void 0:o.silent)&&d.notify("error",null!==(n=null===(e=null==o?void 0:o.messages)||void 0===e?void 0:e.failed)&&void 0!==n?n:c("deleteFailed")),this.dispatchEvent("deleteFail",{index:p[p.length-1],indexPath:p.join("."),item:m,error:v}),[2];I.label=4;case 4:return this.removeEntry(m),b=h,h=(0,s.Z6D)(h,p,1),this.reUseRowId(h,b,p),this.setState((0,i.Cl)({items:h},this.transformState(h)),(function(){return(0,i.sH)(y,void 0,void 0,(function(){return(0,i.YH)(this,(function(t){switch(t.label){case 0:return[4,this.emitValue(h)];case 1:return t.sent()||this.dispatchEvent("deleteSuccess",{value:h,index:p[p.length-1],indexPath:p.join("."),item:m}),[2]}}))}))})),[2]}}))}))},e.prototype.convertToRawPath=function(t,e){var n=(0,i.Cl)((0,i.Cl)({},this.state),e),a=n.filteredItems,s=n.items,r="".concat(t).split(".").map((function(t){return parseInt(t,10)})),o=a[r[0]];return r[0]=s.findIndex((function(t){return t===o})),-1===r[0]?t:r.join(".")},e.prototype.reUseRowId=function(t,e,n){for(var i=e,a=t,s=0,r=n.length;s<r;s++){var o=n[s];if(!(null==i?void 0:i[o])||!(null==a?void 0:a[o]))break;this.entries.set(a[o],this.entries.get(i[o])||this.entityId++),this.entries.delete(i[o]),a=a[o].children,i=i[o].children}},e.prototype.buildItemProps=function(t,e){var n={},i=this.resolveVariableProps(this.props,"minLength"),a=this.resolveVariableProps(this.props,"maxLength");return n.inputTableCanAddItem=!a||a>this.state.items.length,n.inputTableCanRemoveItem=!i||i<this.state.items.length,!1===this.props.needConfirm?(n.quickEditEnabled=!0,n):this.props.editable||this.props.addable||this.state.isCreateMode?(n.quickEditEnabled=this.state.editIndex===this.convertToRawPath(t.path),n):n},e.prototype.buildColumns=function(t,e,n){var o=this;void 0===e&&(e=!1);var d=this.props,u=d.env,c=d.enableStaticTransform,h=d.mobileUI,p=d.testIdBuilder,m=Array.isArray(t.columns)?t.columns.concat():[],v=this.props.classPrefix,b=this.props.translate,y=this.props.needConfirm,I=this.props.static,C=this.props.disabled,g=[];if(!I&&t.addable&&!1!==t.showTableAddBtn&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath,s=e.inputTableCanAddItem;return o.state.editIndex&&!1!==y||!s?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.addRow"),tooltipContainer:t.popOverContainer||u.getModalContainer,disabled:C,onClick:o.addItem.bind(o,o.convertToRawPath(i),void 0,void 0),testIdBuilder:null==p?void 0:p.getChild("addRow-".concat(o.convertToRawPath(i)))},t.addBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.addBtnIcon,className:"icon"}):null,t.addBtnLabel?a.createElement("span",null,t.addBtnLabel):null)}}),!I&&t.childrenAddable&&!1!==t.showTableAddBtn&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath,s=e.row;return o.state.editIndex&&!1!==y?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.subAddRow"),tooltipContainer:t.popOverContainer||u.getModalContainer,disabled:C,onClick:o.subAddItem.bind(o,o.convertToRawPath(i),void 0,s),testIdBuilder:null==p?void 0:p.getChild("subAddRow-".concat(o.convertToRawPath(i)))},t.subAddBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.subAddBtnIcon,className:"icon"}):null,t.subAddBtnLabel?a.createElement("span",null,t.subAddBtnLabel):null)}}),!I&&t.copyable&&!1!==t.showCopyBtn&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath;return o.state.editIndex&&!1!==y?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.copyRow"),tooltipContainer:t.popOverContainer||u.getModalContainer,disabled:C,onClick:o.copyItem.bind(o,o.convertToRawPath(i),void 0),testIdBuilder:null==p?void 0:p.getChild("copyRow-".concat(o.convertToRawPath(i)))},t.copyBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.copyBtnIcon,className:"icon"}):null,t.copyBtnLabel?a.createElement("span",null,t.copyBtnLabel):null)}}),!1===t.needConfirm?m=m.map((function(t){var e=t.quickEdit;return!1===e?l()(t,["quickEdit"]):(0,i.Cl)((0,i.Cl)({},t),"operation"===t.type?{}:{quickEdit:(0,i.Cl)((0,i.Cl)((0,i.Cl)({},o.columnToQuickEdit(t)),e),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,saveImmediately:!0,mode:"inline",disabled:C,static:I||t.static})})})):!0!==I&&(t.addable||t.editable||e)?(m=m.map((function(a,r){var d=!e&&a.hasOwnProperty("quickEditOnUpdate")?a.quickEditOnUpdate:a.quickEdit,u=(0,s.CXN)(null==a?void 0:a.type);return(0,i.Cl)((0,i.Cl)({},!1===d?l()(a,["quickEdit"]):(0,i.Cl)((0,i.Cl)({},a),{quickEdit:(0,i.Cl)((0,i.Cl)((0,i.Cl)({},o.columnToQuickEdit(a)),d),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isQuickEditFormMode:!!(null==u?void 0:u.isFormItem),saveImmediately:!0,mode:"inline",disabled:C})})),c&&!1!==t.needConfirm?{staticOn:"".concat(!e," || data.index !== '").concat(n,"'")}:{})})),!I&&t.editable&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath,s=e.data;return o.state.editIndex||s&&s.hasOwnProperty(f)?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.editRow"),tooltipContainer:t.popOverContainer||u.getModalContainer,disabled:C,onClick:function(){return o.editItem(o.convertToRawPath(i))},testIdBuilder:null==p?void 0:p.getChild("editRow-".concat(o.convertToRawPath(i)))},void 0!==t.updateBtnIcon?t.updateBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.updateBtnIcon,className:"icon"}):null:t.editBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.editBtnIcon,className:"icon"}):null,t.updateBtnLabel||t.editBtnLabel?a.createElement("span",null,t.updateBtnLabel||t.editBtnLabel):null)}}),!I&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath;return o.state.editIndex===o.convertToRawPath(i)?a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("save"),tooltipContainer:t.popOverContainer||u.getModalContainer,onClick:o.confirmEdit,testIdBuilder:null==p?void 0:p.getChild("confirmRow-".concat(o.convertToRawPath(i)))},t.confirmBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.confirmBtnIcon,className:"icon"}):null,t.confirmBtnLabel?a.createElement("span",null,t.confirmBtnLabel):null):null}}),!I&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath;return o.state.editIndex===o.convertToRawPath(i)?a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("cancel"),tooltipContainer:t.popOverContainer||u.getModalContainer,onClick:o.cancelEdit,testIdBuilder:null==p?void 0:p.getChild("cancelRow-".concat(o.convertToRawPath(i)))},t.cancelBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.cancelBtnIcon,className:"icon"}):null,t.cancelBtnLabel?a.createElement("span",null,t.cancelBtnLabel):null):null}})):m=m.map((function(t){var e=(0,s.CXN)(null==t?void 0:t.type);return(null==e?void 0:e.isFormItem)?(0,i.Cl)((0,i.Cl)({},t),{quickEdit:(0,i.Cl)((0,i.Cl)({},t),{visibleOn:"",hiddenOn:"",visible:!0,hidden:!1,isFormMode:!0})}):t})),!I&&t.removable&&g.push({children:function(e){var n=e.key,i=e.rowIndexPath,s=e.data,l=e.inputTableCanRemoveItem;return(o.state.editIndex||s&&s.hasOwnProperty(f))&&!1!==y||!l?null:a.createElement(r.$n,{classPrefix:v,size:"sm",key:n,level:"link",tooltip:b("Table.deleteRow"),tooltipContainer:t.popOverContainer||u.getModalContainer,disabled:C,onClick:o.removeItem.bind(o,o.convertToRawPath(i)),testIdBuilder:null==p?void 0:p.getChild("delRow-".concat(o.convertToRawPath(i)))},t.deleteBtnIcon?a.createElement(r.In,{cx:t.classnames,icon:t.deleteBtnIcon,className:"icon"}):null,t.deleteBtnLabel?a.createElement("span",null,t.deleteBtnLabel):null)}}),g.length){var x=m.find((function(t){return"operation"===t.type}));x||(x={type:"operation",buttons:[],label:b("Table.operation"),className:"v-middle nowrap",fixed:h?"":"right",width:150,innerClassName:"m-n"},m.push(x)),x.buttons=Array.isArray(x.buttons)?x.buttons.concat():[],x.buttons.unshift.apply(x.buttons,g),x.hasOwnProperty("quickEdit")&&delete x.quickEdit}return m},e.prototype.columnToQuickEdit=function(t){var e;return(null===(e=(0,s.CXN)(null==t?void 0:t.type))||void 0===e?void 0:e.isFormItem)||~["group"].indexOf(t.type)?(0,i.Cl)((0,i.Cl)({},t),{label:""}):{type:"input-text"}},e.prototype.handleTableSave=function(t,e,n){var a,r=this;this.setState((function(e,o){var l={},d=e.editIndex,u=e.lastModifiedRow,c=e.items.concat();if(Array.isArray(t))n.forEach((function(n,a){var o=(n=r.convertToRawPath(n,e)).split(".").map((function(t){return parseInt(t,10)})),l=(0,i.Cl)({},(0,s.Jvj)(t,o));c=(0,s.Z6D)(c,o,1,l)}));else{if(n=r.convertToRawPath(n,e),d&&n===d){var h=d.split(".").map((function(t){return parseInt(t,10)})),p=e.items.concat(),m=(0,s.Jvj)(p,h);if(!m)return l;var v=(0,i.Cl)({},t),b=p;return p=(0,s.Z6D)(p,h,1,v),r.reUseRowId(p,b,h),Object.assign(l,(0,i.Cl)({items:p,filteredItems:e.filteredItems.map((function(t){return t===m?v:t})),rowIndex:d},(null==u?void 0:u.index)===d?{}:{lastModifiedRow:m.hasOwnProperty(f)?void 0:{index:d,data:(0,i.Cl)({},m)}})),l}var y=n.split(".").map((function(t){return parseInt(t,10)})),I=(0,i.Cl)({},t),C=c;c=(0,s.Z6D)(c,y,1,I),r.reUseRowId(c,C,y)}return Object.assign(l,(0,i.Cl)({items:c,rowIndex:n},r.transformState(c,e))),a=r.lazyEmitValue,l}),(function(){a&&a()}))},e.prototype.handleRadioChange=function(t,e){var n,a=this,r=e.name,o=e.row,l=e.trueValue,d=void 0===l||l,u=e.falseValue,c=void 0!==u&&u;return this.setState((function(t,e){var l=o.path,u=(0,s.X$u)(t.items,(function(t,e,n,a,s){var o;return(0,i.Cl)((0,i.Cl)({},t),((o={})[r]=l===s.join(".")?d:c,o))}));return n=t.editIndex==o.path?void 0:a.lazyEmitValue,(0,i.Cl)({items:u},a.transformState(u))}),(function(){null==n||n()})),!1},e.prototype.handleSaveTableOrder=function(t,e){(0,this.props.onChange)(e.map((function(t){return(0,i.Cl)({},t)})))},e.prototype.handlePageChange=function(t){this.setState((0,i.Cl)({},this.transformState(this.state.items,{page:t})))},e.prototype.handleTableQuery=function(t){t=(0,i.Cl)((0,i.Cl)({},this.state.query),t),this.setState((0,i.Cl)({query:t},this.transformState(this.state.items,{query:t})))},e.prototype.handlePristineChange=function(t,e){var n=this,a=this.props.needConfirm,r=e.split(".").map((function(t){return parseInt(t,10)}));this.setState((function(e){var a=e.items.concat(),o=(0,s.Jvj)(a,r),l=(0,i.Cl)((0,i.Cl)({},o),t),d=a;return a=(0,s.Z6D)(a,r,1,l),n.reUseRowId(a,d,r),(0,i.Cl)({items:a},n.transformState(a))}),(function(){!1===a&&n.emitValue()}))},e.prototype.removeEntry=function(t){this.entries.has(t)&&this.entries.delete(t)},e.prototype.getEntryId=function(t){return this.entries.has(t)||this.entries.set(t,this.entityId++),String(this.entries.get(t))},e.prototype.tableRef=function(t){for(;t&&t.getWrappedInstance;)t=t.getWrappedInstance();this.table=t},e.prototype.computedAddBtnDisabled=function(){return this.props.disabled||!!this.state.editIndex},e.prototype.filterItemIndex=function(t){return this.convertToRawPath(t)},e.prototype.render=function(){var t=this,e=this.props,n=e.className,s=(e.style,e.value,e.disabled),r=e.render,o=e.placeholder,l=e.draggable,d=e.addable,u=e.columnsTogglable,c=e.combineNum,h=e.combineFromIndex,p=e.translate,m=e.canAccessSuperData,f=e.expandConfig,v=e.affixRow,b=e.prefixRow,y=e.formInited,I=e.perPage,C=e.classnames,g=e.rowClassName,x=e.rowClassNameExpr,w=e.affixHeader,E=void 0!==w&&w,P=e.autoFillHeight,R=void 0!==P&&P,A=e.tableContentClassName,B=e.static,k=e.showFooterAddBtn,S=e.footerAddBtn,F=e.toolbarClassName,T=e.onEvent,O=e.testIdBuilder,H=e.showIndex,D=this.resolveVariableProps(this.props,"maxLength");if(!1===y)return null;var j=this.state.query,N=this.state.filteredItems,V=(this.state.items,"number"==typeof I),L=this.state.page||1,z=!B&&d&&!1!==k&&(!D||D>this.state.items.length);return a.createElement("div",{className:C("InputTable",n)},r("body",{type:"table",placeholder:p(o),columns:this.state.columns,affixHeader:E,prefixRow:b,affixRow:v,autoFillHeight:R,tableContentClassName:A,onEvent:T,showIndex:H},{ref:this.tableRef,value:void 0,saveImmediately:!0,disabled:s,draggable:l&&!this.state.editIndex,items:N,getEntryId:this.getEntryId,reUseRow:"match",onSave:this.handleTableSave,onRadioChange:this.handleRadioChange,onSaveOrder:this.handleSaveTableOrder,buildItemProps:this.buildItemProps,quickEditFormRef:this.subFormRef,quickEditFormItemRef:this.subFormItemRef,columnsTogglable:u,combineNum:c,combineFromIndex:h,expandConfig:f,canAccessSuperData:m,rowClassName:g,rowClassNameExpr:x,onPristineChange:this.handlePristineChange,testIdBuilder:null==O?void 0:O.getChild("table"),onQuery:this.handleTableQuery,query:j,orderBy:null==j?void 0:j.orderBy,orderDir:null==j?void 0:j.orderDir,filterItemIndex:this.filterItemIndex}),z||V?a.createElement("div",{className:C("InputTable-toolbar",F)},z?r("button",(0,i.Cl)({type:"button",level:"primary",size:"sm",label:p("Table.add"),icon:"fa fa-plus",disabledTip:p("Table.addButtonDisabledTip")},S||{}),{disabled:this.computedAddBtnDisabled(),onClick:function(){return t.addItem()},testIdBuilder:null==O?void 0:O.getChild("add")}):null,V?r("pager",{type:"pagination"},{activePage:L,perPage:I,total:this.state.total,onPageChange:this.handlePageChange,className:"InputTable-pager",testIdBuilder:null==O?void 0:O.getChild("page"),disabled:!!this.state.editIndex}):null):null)},e.defaultProps={placeholder:"placeholder.empty",scaffold:{},addBtnIcon:"plus",subAddBtnIcon:"sub-plus",copyBtnIcon:"copy",editBtnIcon:"pencil",deleteBtnIcon:"minus",confirmBtnIcon:"check",cancelBtnIcon:"close",valueField:"",minLength:0,maxLength:1/0,showFooterAddBtn:!0,showTableAddBtn:!0},e.propsList=["onChange","name","columns","label","scaffold","showTableAddBtn","addable","removable","copyable","editable","addApi","updateApi","deleteApi","needConfirm","canAccessSuperData","formStore","footerActions","toolbarClassName"],(0,i.Cg)([s.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,String]),(0,i.Sn)("design:returntype",void 0)],e.prototype,"handlePristineChange",null),e}(a.Component),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.C6)(e,t),e.prototype.setData=function(t,e,n,a){return(0,i.sH)(this,void 0,void 0,(function(){var e,r,o,l,d=this;return(0,i.YH)(this,(function(u){switch(u.label){case 0:return this.state.items.length,void 0===n?[3,1]:(e=(0,i.fX)([],(0,i.zs)(this.state.items),!1),String(n).split(",").forEach((function(n){var i=n.split(".").map((function(t){return parseInt(t,10)})),a=e;e=(0,s.Z6D)(e,i,1,t),d.reUseRowId(e,a,i)})),this.setState((0,i.Cl)({items:e},this.transformState(e)),(function(){d.emitValue()})),[3,4]);case 1:return void 0===a?[3,3]:(r=(0,i.fX)([],(0,i.zs)(this.state.items),!1),o=[],(0,s.IFF)(r,(function(e,n,l,u,c){return o.unshift((function(){return(0,i.sH)(d,void 0,void 0,(function(){var o;return(0,i.YH)(this,(function(l){switch(l.label){case 0:return[4,(0,s.JnN)(a,e)];case 1:return l.sent()&&(o=r,r=(0,s.Z6D)(r,(0,i.fX)((0,i.fX)([],(0,i.zs)(c),!1),[n],!1),1,t),this.reUseRowId(r,o,(0,i.fX)((0,i.fX)([],(0,i.zs)(c),!1),[n],!1))),[2]}}))}))})),!0})),[4,Promise.all(o.map((function(t){return t()})))]);case 2:return u.sent(),this.setState((0,i.Cl)({items:r},this.transformState(r)),(function(){d.emitValue()})),[3,4];case 3:l=(0,i.fX)([],(0,i.zs)(t),!1),this.setState((0,i.Cl)({items:l},this.transformState(l)),(function(){d.emitValue()})),u.label=4;case 4:return[2]}}))}))},e.prototype.doAction=function(e,n,a,r){var o,l,d,c,h,p,m;return void 0===a&&(a=!1),(0,i.sH)(this,void 0,void 0,(function(){var f,v,b,y,I,C,g,x,w,E,P,R,A,B,k,S,F,T,O,H,D,j,N,V=this;return(0,i.YH)(this,(function(L){switch(L.label){case 0:return f=this.props,v=f.valueField,b=f.env,y=f.needConfirm,f.addable,I=f.addApi,C=f.deleteApi,g=f.resetValue,x=f.translate,w=f.onChange,E=f.formStore,P=f.store,R=f.name,A=e.actionType,B=(null===(o=this.props.store)||void 0===o?void 0:o.data)||{},"addItem"!==A?[3,6]:(k=this.state.items.concat(),I||r?(S=null,(0,s.Amo)(I,B)?[4,b.fetcher(I,B)]:[3,2]):[3,4]);case 1:return(D=L.sent())&&!D.ok?(!(null==I?void 0:I.silent)&&b.notify("error",null!==(d=null===(l=null==I?void 0:I.messages)||void 0===l?void 0:l.failed)&&void 0!==d?d:D.msg||x("fetchFailed")),[2]):(D&&D.ok&&(S=D.data),[3,3]);case 2:S=r.item,L.label=3;case 3:return S=(Array.isArray(S)?S:[S]).filter((function(t){return!v||!u()(k,(function(e){return e[v]==t[v]}))})),F=[],"string"==typeof r.index&&/^\d+(\.\d+)*$/.test(r.index)?F=r.index.split(".").map((function(t){return parseInt(t,10)})):"number"==typeof r.index&&(F=[r.index]),F.length?k=s.Z6D.apply(void 0,(0,i.fX)([k,F,0],(0,i.zs)(S),!1)):k.push.apply(k,(0,i.fX)([],(0,i.zs)(S),!1)),this.setState((0,i.Cl)({items:k},this.transformState(k)),(function(){if(1===S.length&&!1!==y){var t=F.concat();t[t.length-1]+=1,V.startEdit(t.join("."),!0)}else null==w||w(k)})),[2];case 4:return[2,this.addItem("".concat(k.length-1),!1)];case 5:return[3,13];case 6:return"deleteItem"!==A?[3,12]:(T=(0,i.fX)([],(0,i.zs)(this.state.items),!1),O=[],void 0===(null==r?void 0:r.index)?[3,7]:(String(r.index).split(",").forEach((function(t){var e=t.split(".").map((function(t){return parseInt(t,10)}));O.push((0,s.Jvj)(T,e)),T=(0,s.Z6D)(T,e,1)})),[3,9]));case 7:return void 0===(null==r?void 0:r.condition)?[3,9]:(H=[],(0,s.IFF)(T,(function(t,e,n,a,o){return H.unshift((function(){return(0,i.sH)(V,void 0,void 0,(function(){return(0,i.YH)(this,(function(n){switch(n.label){case 0:return[4,(0,s.JnN)(null==r?void 0:r.condition,t)];case 1:return n.sent()&&(O.push(t),T=(0,s.Z6D)(T,(0,i.fX)((0,i.fX)([],(0,i.zs)(o),!1),[e],!1),1)),[2]}}))}))})),!0})),[4,H.reduce((function(t,e){return t.then(e)}),Promise.resolve())]);case 8:L.sent(),L.label=9;case 9:return(0,s.Amo)(C,(0,s.ed2)(B,{deletedItems:O}))?[4,b.fetcher(C,(0,s.ed2)(B,{deletedItems:O}))]:[3,11];case 10:if((D=L.sent())&&!D.ok)return!(null==C?void 0:C.silent)&&b.notify("error",null!==(h=null===(c=null==C?void 0:C.messages)||void 0===c?void 0:c.failed)&&void 0!==h?h:D.msg||x("fetchFailed")),[2];L.label=11;case 11:return this.setState((0,i.Cl)({items:T},this.transformState(T)),(function(){null==w||w(T)})),[2];case 12:if("clear"===A)return this.setState({items:[]},(function(){null==w||w([])})),[2];if("reset"===A)return j=null!==(m=(0,s.dnO)(null!==(p=null==E?void 0:E.pristine)&&void 0!==p?p:null==P?void 0:P.pristine,R))&&void 0!==m?m:g,N=Array.isArray(j)?j:[],this.setState((0,i.Cl)({items:N},this.transformState(N)),(function(){null==w||w(N)})),[2];L.label=13;case 13:return[2,t.prototype.doAction.call(this,e,n,a,B)]}}))}))},(0,i.Cg)([(0,s.eIh)({type:"input-table"})],e)}(v)}}]);