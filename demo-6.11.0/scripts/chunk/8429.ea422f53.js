"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[8429],{48429:function(e,t,n){n.r(t),n.d(t,{PickerControlRenderer:function(){return F},default:function(){return O}});var i=n(31635),o=n(96540),r=n(32485),s=n.n(r),l=n(90179),a=n.n(l),p=n(7309),c=n.n(p),d=n(2404),u=n.n(d),m=n(24713),h=n.n(m),v=n(55364),g=n.n(v),f=n(62758),y=n(71121),C=n(80191),k=n.n(C),S=n(66283),b=n(22451),O=function(e){function t(t){var n=e.call(this,t)||this;n.state={isOpened:!1,schema:n.buildSchema(n.props),isFocused:!1},n.input=o.createRef(),n.toDispose=[],n.mounted=!1;var r=t.formInited,s=t.addHook,l=t.formItem,a=function(){return(0,i.sH)(n,void 0,void 0,(function(){var e=this;return(0,i.YH)(this,(function(t){switch(t.label){case 0:return[4,this.fetchOptions()];case 1:return t.sent(),this.mounted&&this.toDispose.push((0,b.mJ)((function(){return JSON.stringify(null==l?void 0:l.tmpValue)}),(function(){return e.fetchOptions()}))),[2]}}))}))};return l&&n.toDispose.push(r||!s?l.addInitHook(a):s(a,"init")),n}return(0,i.C6)(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentDidUpdate=function(e){var t,n=this.props;["multiple","source","pickerSchema"].some((function(t){return!u()(e[t],n[t])}))?this.setState({schema:this.buildSchema(n)}):(0,f.B92)(e.source,n.source,e.data,n.data)&&(null===(t=n.formItem)||void 0===t?void 0:t.inited)&&this.fetchOptions()},t.prototype.componentWillUnmount=function(){this.toDispose.forEach((function(e){return e()})),this.toDispose=[],this.mounted=!1},t.prototype.fetchOptions=function(){var e,t,n=this.props,i=n.value,o=n.formItem,r=n.valueField,s=n.labelField,l=n.source,a=n.data;if(l&&o&&(r||"value")!==(s||"label")&&(!(t=o.getSelectedOptions(i))||t.length&&t[0][r||"value"]===t[0][s||"label"])){var p=(0,f.ed2)(a,((e={value:i})[r||"value"]=i,e.op="loadOptions",e));if((0,f.joH)(l))o.setOptions((0,f.GvO)(l,a,"| raw"));else if((0,f.Amo)(l,p))return o.loadOptions(l,p,{autoAppend:!0})}},t.prototype.buildSchema=function(e){var t,n,o=(0,f.joH)(e.source);return(0,i.Cl)((0,i.Cl)({checkOnItemClick:!0,listItem:{title:"${".concat(e.labelField||"label","|raw}")}},e.pickerSchema),{labelTpl:null!==(n=null===(t=e.pickerSchema)||void 0===t?void 0:t.labelTpl)&&void 0!==n?n:e.labelTpl,type:"crud",pickerMode:!0,syncLocation:!1,filterCanAccessSuperData:!1,api:o?null:e.source,source:o?e.source:null,keepItemSelectionOnPageChange:!0,valueField:e.valueField,labelField:e.labelField,bulkActions:e.multiple?e.pickerSchema.bulkActions:[]})},t.prototype.crudRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.crud=e},t.prototype.reload=function(){if(this.crud)this.crud.search();else{var e=this.props.reloadOptions;e&&e()}},t.prototype.open=function(){this.setState({isOpened:!0})},t.prototype.close=function(){this.setState({isOpened:!1})},t.prototype.handleModalConfirm=function(e,t,n,o){return(0,i.sH)(this,void 0,void 0,(function(){var t;return(0,i.YH)(this,(function(n){switch(n.label){case 0:return t=h()(o,(function(e){return"crud"===e.props.type})),[4,this.handleChange(e[t].items)];case 1:return n.sent(),this.close(),[2]}}))}))},t.prototype.handleChange=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r,s,l,a,p,d,u,m,h,v,g;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.joinValues,o=t.valueField,r=t.delimiter,s=t.extractValue,l=t.multiple,a=t.options,t.data,p=t.dispatchEvent,t.selectedOptions,d=t.setOptions,u=t.onChange,m=e,m=n?e.map((function(e){return e[o||"value"]})).join(r||","):s?l?e.map((function(e){return e[o||"value"]})):e[0]&&e[0][o||"value"]||"":l?e:e[0],h=[],e.forEach((function(e){c()(a,(function(t){return e[o||"value"]==t[o||"value"]}))||h.push(e)})),h.length&&d(a.concat(h)),v=l?e:e[0],[4,p("change",(0,f.RKM)(this.props,{value:m,option:v,selectedItems:v}))];case 1:return(null==(g=i.sent())?void 0:g.prevented)||u(m),[2]}}))}))},t.prototype.handleItemClick=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.data,[4,(0,t.dispatchEvent)("itemClick",(0,f.ed2)(n,{item:e}))];case 1:return null==(o=i.sent())||o.prevented,[2]}}))}))},t.prototype.removeItem=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r,s,l,a,p,c,d,u,m,h,v;return(0,i.YH)(this,(function(g){switch(g.label){case 0:return t=this.props,n=t.selectedOptions,o=t.joinValues,r=t.extractValue,s=t.delimiter,l=t.valueField,a=t.onChange,p=t.multiple,c=t.dispatchEvent,d=n.concat(),u=(0,i.zs)(d.splice(e,1),1),m=u[0],h=d,h=o?d.map((function(e){return e[l||"value"]})).join(s||","):r?p?d.map((function(e){return e[l||"value"]})):d[0]&&d[0][l||"value"]||"":p?d:d[0],[4,c("change",(0,f.RKM)(this.props,{value:h,option:m,selectedItems:m}))];case 1:return(null==(v=g.sent())?void 0:v.prevented)||a(h),[2]}}))}))},t.prototype.handleKeyDown=function(e){var t=this.props.selectedOptions;" "===e.key?(this.open(),e.preventDefault()):t.length&&"Backspace"==e.key&&this.removeItem(t.length-1)},t.prototype.handleFocus=function(e){this.input.current&&this.input.current.focus(),e.stopPropagation(),this.setState({isFocused:!0})},t.prototype.handleBlur=function(){this.setState({isFocused:!1})},t.prototype.handleClick=function(){this.open()},t.prototype.clearValue=function(e){e.stopPropagation();var t=this.props,n=t.onChange,i=t.resetValue;n(void 0!==i?i:"")},t.prototype.getOverflowConfig=function(){var e=this.props.overflowConfig;return g()(t.defaultProps.overflowConfig,e)},t.prototype.handleSelect=function(e,t){var n=this.props,i=n.selectedOptions,o=n.valueField;if(Array.isArray(e)&&Array.isArray(t)&&(e.length||t.length)){var r=k()(e,i,(function(e,t){var n=e[o||"value"],i=t[o||"value"];return n||i?n===i:u()(a()(e,"value"),a()(t,"value"))}));r.length===e.length&&r.length===i.length||this.handleChange(e)}},t.prototype.renderTag=function(e,t){var n=this,r=this.props,s=r.itemClearable,l=void 0===s||s,a=r.classPrefix,p=r.classnames,c=r.labelField,d=r.labelTpl,u=(r.translate,r.disabled),m=r.env,h=r.id,v=r.themeCss,g=r.css;return o.createElement("div",{key:t,className:p("".concat(a,"Picker-value"),(0,f.NH8)((0,i.Cl)((0,i.Cl)({},this.props),{name:"pickValueWrapClassName",id:h,themeCss:v||g})),{"is-disabled":u})},l&&o.createElement("span",{className:p("".concat(a,"Picker-valueIcon"),(0,f.NH8)((0,i.Cl)((0,i.Cl)({},this.props),{name:"pickValueIconClassName",id:h,themeCss:v||g}))),onClick:function(e){e.stopPropagation(),n.removeItem(t)}},"×"),o.createElement(y.Fo,{inline:!1,tooltip:(0,f.dnO)(e,c||"label")},o.createElement("span",{className:p("".concat(a,"Picker-valueLabel"),(0,f.NH8)((0,i.Cl)((0,i.Cl)({},this.props),{name:"pickFontClassName",id:h,themeCss:v||g}))),onClick:function(t){t.stopPropagation(),n.handleItemClick(e)}},d?o.createElement(y.Ed,{html:(0,f.pbD)(d,e),filterHtml:m.filterHtml}):"".concat((0,f.dnO)(e,c||"label")||(0,f.dnO)(e,"id")))))},t.prototype.renderValues=function(){var e=this,t=this.props,n=t.classPrefix,r=t.selectedOptions,l=t.translate,p=t.disabled,c=t.multiple,d=t.popOverContainer,u=t.id,m=t.themeCss,h=t.css,v=this.getOverflowConfig(),g=v.maxTagCount,C=v.overflowTagPopover,k=r.length,S=r,b=!1!==c&&(0,f.z09)(g,{start:0,end:k,left:"inclusive",right:"exclusive"});return b&&(S=(0,i.fX)((0,i.fX)([],(0,i.zs)(r.slice(0,g)),!1),[{label:"+ ".concat(k-g," ..."),value:"__overflow_tag__"}],!1)),o.createElement(o.Fragment,null,S.map((function(t,c){return b&&c===g?o.createElement(y.T_,{key:c,container:d,tooltip:(0,i.Cl)((0,i.Cl)({tooltipClassName:s()("Picker-overflow",null==C?void 0:C.tooltipClassName),title:l("已选项")},a()(C,["children","content","tooltipClassName"])),{children:function(){return o.createElement("div",{className:s()("".concat(n,"Picker-overflow-wrapper"))},r.slice(g,k).map((function(t,n){var i=n+g;return e.renderTag(t,i)})))}})},o.createElement("div",{key:c,className:s()("".concat(n,"Picker-value"),{"is-disabled":p})},o.createElement("span",{className:"".concat(n,"Picker-valueLabel ").concat((0,f.NH8)((0,i.Cl)((0,i.Cl)({},e.props),{name:"pickFontClassName",id:u,themeCss:m||h})))},t.label))):e.renderTag(t,c)})))},t.prototype.overrideCRUDProps=function(){return{}},t.prototype.renderBody=function(e){var t=(void 0===e?{}:e).popOverContainer,n=this.props,o=n.render,r=n.selectedOptions,s=n.options,l=n.multiple,a=n.valueField,p=n.embed,c=n.source,d=n.strictMode,u=n.testIdBuilder,m=this.getOverflowConfig(),h=m.maxTagCount,v=m.overflowTagPopoverInCRUD,g=m.displayPosition;return o("modal-body",this.state.schema,(0,i.Cl)((0,i.Cl)({value:r,valueField:a,primaryField:a,options:c?[]:s,multiple:l,strictMode:d,onSelect:p?this.handleSelect:void 0,testIdBuilder:null==u?void 0:u.getChild("body-schema"),ref:this.crudRef,popOverContainer:t},p||Array.isArray(g)&&g.includes("crud")?{maxTagCount:h,overflowTagPopover:v}:{}),this.overrideCRUDProps()))},t.prototype.render=function(){var e=this.props,t=e.className,n=(e.style,e.modalClassName),r=e.classnames,s=e.disabled,l=e.render,a=e.modalMode,p=e.source,c=e.size,d=e.clearable,u=e.multiple,m=e.placeholder,h=e.embed,v=e.selectedOptions,g=e.translate,C=e.popOverContainer,k=e.modalTitle,S=e.data,b=e.mobileUI,O=e.env,F=e.themeCss,P=e.css,N=e.id,w=e.classPrefix,I=e.testIdBuilder;return o.createElement("div",{className:r("PickerControl",{"is-mobile":b},t)},h?o.createElement("div",{className:r("Picker")},this.renderBody({popOverContainer:C})):o.createElement("div",{className:r("Picker",{"Picker--single":!u,"Picker--multi":u,"is-focused":this.state.isFocused,"is-disabled":s})},o.createElement("div",{onClick:this.handleClick,className:r("Picker-input",s&&"is-disabled",this.state.isFocused&&"is-focused",(0,f.NH8)((0,i.Cl)((0,i.Cl)({},this.props),{name:"pickControlClassName",id:N,themeCss:F||P})))},!v.length&&m?o.createElement("div",{className:r("Picker-placeholder")},g(m)):o.createElement("div",(0,i.Cl)({className:r("Picker-valueWrap")},null==I?void 0:I.getTestId()),this.renderValues(),o.createElement("input",{onChange:f.lQ1,value:"",ref:this.input,onKeyDown:this.handleKeyDown,onClick:this.handleFocus,onBlur:this.handleBlur,readOnly:b})),d&&!s&&v.length?o.createElement("a",{onClick:this.clearValue,className:r("Picker-clear")},o.createElement(y.In,{icon:"input-clear",className:"icon"})):null,o.createElement("span",(0,i.Cl)({onClick:this.open,className:r("Picker-btn")},null==I?void 0:I.getChild("picker-open-btn").getTestId()),o.createElement(y.In,{icon:"window-restore",className:r("icon",(0,f.NH8)((0,i.Cl)((0,i.Cl)({},this.props),{name:"pickIconClassName",id:N,themeCss:F||P}))),iconContent:"Picker-icon"}))),l("modal",{title:k&&"string"==typeof k?(0,f.pbD)(k,S):g("Select.placeholder"),size:c,type:a,className:n,body:{children:this.renderBody},testIdBuilder:null==I?void 0:I.getChild("modal")},{key:"modal",lazyRender:!!p,onConfirm:this.handleModalConfirm,onClose:this.close,show:this.state.isOpened})),o.createElement(f.z4D,(0,i.Cl)({},this.props,{config:{themeCss:F||P,classNames:[{key:"pickControlClassName",weights:{default:{important:!0},hover:{important:!0},focused:{important:!0,parent:".".concat(w,"Picker.is-focused >")},disabled:{important:!0,parent:".".concat(w,"Picker.is-disabled >")}}},{key:"pickFontClassName"},{key:"pickValueWrapClassName",weights:{default:{important:!0}}},{key:"pickValueIconClassName",weights:{default:{important:!0},hover:{important:!0}}},{key:"pickIconClassName",weights:{default:{suf:" svg"}}}],id:N},env:O})))},t.propsList=["modalTitle","modalMode","pickerSchema","labelField","onChange","options","value","inline","multiple","embed","resetValue","placeholder","onQuery"],t.defaultProps={modalMode:"dialog",multiple:!1,placeholder:"Picker.placeholder",labelField:"label",valueField:"value",pickerSchema:{mode:"list"},embed:!1,overflowConfig:{maxTagCount:-1,displayPosition:["select","crud"],overflowTagPopover:{placement:"top",trigger:"hover",showArrow:!1,offset:[0,-5]},overflowTagPopoverInCRUD:{placement:"bottom",trigger:"hover",showArrow:!1,offset:[0,0]}}},(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",Object)],t.prototype,"fetchOptions",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"crudRef",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"open",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"close",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Array,Object,Object,Array]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleModalConfirm",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Array]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleItemClick",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleKeyDown",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleFocus",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleBlur",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleClick",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"clearValue",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Array,Array]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"handleSelect",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"overrideCRUDProps",null),(0,i.Cg)([f.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"renderBody",null),(0,i.Cg)([(0,S.E)(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(o.PureComponent),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.C6)(t,e),(0,i.Cg)([(0,f.QqA)({type:"picker",autoLoadOptionsFromSource:!1,sizeMutable:!1})],t)}(O)}}]);