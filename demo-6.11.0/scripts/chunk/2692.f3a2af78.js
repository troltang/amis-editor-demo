"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[2692],{72692:function(e,t,r){r.r(t),r.d(t,{PdfView:function(){return s},PdfViewerRenderer:function(){return d},default:function(){return a}});var n=r(31635),i=r(96540),o=r(62758),s=i.lazy((function(){return r.e(9793).then(r.bind(r,59793))})),a=function(e){function t(t){var r=e.call(this,t)||this;return r.wrapper=i.createRef(),r.state={inited:!1,loading:!1,error:!1},r}return(0,n.C6)(t,e),t.prototype.componentDidMount=function(){this.wrapper.current&&this.setState({width:this.wrapper.current.clientWidth-100}),this.renderPdf()},t.prototype.componentDidUpdate=function(e){var t=this,r=this.props;((0,o.B92)(e.src,r.src,e.data,r.data)||(0,o.GvO)(r.src,r.data,"| raw")!==(0,o.GvO)(e.src,e.data,"| raw"))&&(this.abortLoad(),setTimeout((function(){t.fetchPdf()}),0)),(0,o.dnO)(r.data,r.name)&&(0,o.dnO)(e.data,e.name)!==(0,o.dnO)(r.data,r.name)&&(this.abortLoad(),this.renderPdf())},t.prototype.componentWillUnmount=function(){this.abortLoad()},t.prototype.abortLoad=function(){this.fetchCancel&&(this.fetchCancel("load canceled"),this.fetchCancel=void 0),this.reader&&(this.reader.abort(),this.reader=void 0)},t.prototype.renderPdf=function(){return(0,n.sH)(this,void 0,void 0,(function(){var e,t,r,i;return(0,n.YH)(this,(function(n){switch(n.label){case 0:return e=this.props,t=e.src,r=e.name,i=e.data,this.setState({error:!1}),t?this.file?[3,2]:[4,this.fetchPdf()]:[3,3];case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:return(0,o.dnO)(i,r)?[4,this.renderFormFile()]:[3,5];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},t.prototype.fetchPdf=function(){return(0,n.sH)(this,void 0,void 0,(function(){var e,t,r,i,s,a,d,p,c=this;return(0,n.YH)(this,(function(n){switch(n.label){case 0:if(e=this.props,t=e.env,r=e.src,i=e.data,e.translate,r&&("string"==typeof(a=(0,o.GvO)(r,i,"| raw"))?s=a:"object"==typeof a&&"string"==typeof a.value&&(s=a.value)),!s)return console.warn("file src is empty"),[2];this.setState({inited:!0,loading:!0,error:!1}),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,t.fetcher(s,i,{responseType:"arraybuffer",cancelExecutor:function(e){return c.fetchCancel=e}})];case 2:return d=n.sent(),this.file=d.data,this.forceUpdate(),[3,5];case 3:return p=n.sent(),this.setState({error:!0}),console.error(p),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}}))}))},t.prototype.renderFormFile=function(){return(0,n.sH)(this,void 0,void 0,(function(){var e,t,r,i,s,a=this;return(0,n.YH)(this,(function(n){return e=this.props,t=e.name,r=e.data,i=(0,o.dnO)(r,t),this.setState({inited:!0,loading:!0}),i instanceof File&&((s=new FileReader).onload=function(e){var t=s.result;a.file=t,a.setState({loading:!1}),a.forceUpdate()},s.onerror=function(e){a.setState({error:!0})},s.readAsArrayBuffer(i),this.reader=s),[2]}))}))},t.prototype.renderEmpty=function(){var e=this.props,t=e.src,r=e.name;return t||r?null:i.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},i.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),i.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"PDF viewer"))},t.prototype.renderError=function(){var e=this.props,t=e.src,r=e.translate;return this.state.error&&t?i.createElement("div",null,r("loadingFailed")+" url:"+t):null},t.prototype.renderTip=function(){return i.createElement("div",null,i.createElement("p",null,"[PdfViewer]: pdfjsWorkerSrc is required, Please set the `pdfjsWorkerSrc` in setGlobalOptions function."))},t.prototype.render=function(){var e=this.props,t=e.className,r=e.classnames,n=(e.translate,e.height),a=e.background,d=(0,o.u7$)().pdfjsWorkerSrc,p=this.state,c=p.loading,l=p.inited,u=p.error,h=Math.max(this.props.width||this.state.width,300);return i.createElement("div",{ref:this.wrapper},this.renderEmpty(),d?i.createElement(i.Suspense,{fallback:i.createElement("div",null,"...")},l&&!u?i.createElement(s,{file:this.file,loading:c,className:t,classnames:r,width:h,height:n,background:a}):null):this.renderTip(),this.renderError())},(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",void 0)],t.prototype,"abortLoad",null),(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],t.prototype,"renderPdf",null),(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],t.prototype,"fetchPdf",null),(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],t.prototype,"renderFormFile",null),(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",void 0)],t.prototype,"renderEmpty",null),(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",void 0)],t.prototype,"renderError",null),(0,n.Cg)([o.d6t,(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",void 0)],t.prototype,"renderTip",null),t}(i.Component),d=function(e){function t(t,r){var n=e.call(this,t)||this;return r.registerComponent(n),n}return(0,n.C6)(t,e),t.prototype.componentWillUnmount=function(){var t;null===(t=e.prototype.componentWillUnmount)||void 0===t||t.call(this),this.context.unRegisterComponent(this)},t.contextType=o.MzX,(0,n.Cg)([(0,o.A49)({type:"pdf-viewer"}),(0,n.Sn)("design:paramtypes",[Object,Object])],t)}(a)}}]);