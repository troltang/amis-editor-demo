"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[3187],{33187:function(e,t,n){n.r(t),n.d(t,{TreeControlRenderer:function(){return f},default:function(){return g}});var i=n(31635),o=n(96540),r=n(90179),l=n.n(r),a=n(38221),s=n.n(a),d=n(32485),p=n.n(d),h=n(51545),u=n(71121),c=n(41376),v=n(62758),m=n(66283),g=function(e){function t(t){var n,i=this;return(i=e.call(this,t)||this).rootRef=o.createRef(),i.state={keyword:"",filteredOptions:null!==(n=i.props.options)&&void 0!==n?n:[],allowSearch:!1,virtualListHeight:0,othersHeight:0},i.handleSearch=s()(i.handleSearch.bind(i),250,{trailing:!0,leading:!1}),i}return(0,i.C6)(t,e),t.prototype.componentDidMount=function(){var e,t=this;this.props.heightAuto&&(this.initOthersHeight(),this.handleVirtualListHeight(),this.unSensor=(0,v.zMn)(null===(e=this.rootRef.current)||void 0===e?void 0:e.parentElement,(function(){t.handleVirtualListHeight()}),!1,"height"))},t.prototype.componentDidUpdate=function(e,t){var n=this.props,i=this.state,o=this.state.keyword;if(e.options!==n.options||e.searchable!==n.searchable){var r=n.options,l=n.searchable;this.setState({filteredOptions:l&&o?this.filterOptions(r,o):r})}(0,v.TIf)(["label","searchable","creatable","hideRoot","themeCss","wrapperCustomStyle","heightAuto"],e,n)&&n.heightAuto&&this.initOthersHeight(),t.othersHeight!==i.othersHeight&&n.heightAuto&&this.handleVirtualListHeight()},t.prototype.componentWillUnmount=function(){this.unSensor&&(this.unSensor(),delete this.unSensor)},t.prototype.initOthersHeight=function(){var e,t,n=this,i=this.rootRef.current,o=null===(e=this.rootRef.current)||void 0===e?void 0:e.parentElement,r=this.treeRef.virtualListRef.current,l=null===(t=this.treeRef.virtualListRef.current)||void 0===t?void 0:t.parentElement;if(o&&l&&r&&i){var a=function(e,t){return Array.from(e.children).filter((function(e){return e!==t})).reduce((function(e,t){return e+t.offsetHeight+n.getElementVerticalMargin(t)}),0)},s=a(o,i)+this.getElementVerticalMargin(i)+a(l,r)+i.offsetHeight-l.offsetHeight;this.setState({othersHeight:s})}},t.prototype.handleVirtualListHeight=function(){var e,t=this.state.othersHeight,n=null===(e=this.rootRef.current)||void 0===e?void 0:e.parentElement;if(n){var i=n.offsetHeight-t;this.setState({virtualListHeight:i>0?i:0})}},t.prototype.getElementVerticalMargin=function(e){var t=window.getComputedStyle(e,null);return parseInt(t.marginTop||"0")+parseInt(t.marginBottom||"0")},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.doAction=function(e,t,n){var i,o,r,l,a,s,d,p,h,u,c,m=null==e?void 0:e.actionType,g=this.props,f=g.resetValue,y=g.onChange,C=g.formStore,b=g.store,S=g.name;if("clear"===m)null==y||y("");else if("reset"===m){var O=null!==(o=(0,v.dnO)(null!==(i=null==C?void 0:C.pristine)&&void 0!==i?i:null==b?void 0:b.pristine,S))&&void 0!==o?o:f;null==y||y(null!=O?O:"")}else"expand"===e.actionType?this.treeRef.syncUnFolded(this.props,null===(r=e.args)||void 0===r?void 0:r.openLevel):"collapse"===e.actionType?this.treeRef.syncUnFolded(this.props,(null===(l=e.args)||void 0===l?void 0:l.closeLevel)||0):"add"===e.actionType?this.addItemFromAction(null===(a=e.args)||void 0===a?void 0:a.item,null===(s=e.args)||void 0===s?void 0:s.parentValue):"edit"===e.actionType?this.editItemFromAction(null===(d=e.args)||void 0===d?void 0:d.item,null===(p=e.args)||void 0===p?void 0:p.originValue):"delete"===e.actionType?this.deleteItemFromAction(null===(h=e.args)||void 0===h?void 0:h.value):"reload"===e.actionType?this.reload():"search"===m&&(this.setState({allowSearch:!!(null===(u=e.args)||void 0===u?void 0:u.keyword)}),this.handleSearch(null===(c=e.args)||void 0===c?void 0:c.keyword))},t.prototype.resolveOption=function(e,t){var n=this;return(0,v.cym)(e,(function(e){var i=n.props.valueField||"value";return((0,v.Bdw)(e,i)?e[i]:"")===t}))},t.prototype.addItemFromAction=function(e,t){var n=this.props,i=n.onAdd,o=n.options,r=n.valueField,l=(0,v.iXH)(o,(function(e){var n=r||"value";return((0,v.Bdw)(e,n)?e[n]:"")===t}))||[];i&&i(l.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var n=this.props,o=n.onEdit,r=n.options,l=this.resolveOption(r,t);o&&l&&o((0,i.Cl)((0,i.Cl)({},e),{originValue:t}),l,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,n=t.onDelete,i=t.options,o=this.resolveOption(i,e);n&&o&&n(o)},t.prototype.filterOptions=function(e,t){var n=this,o=this.props,r=o.labelField,l=o.valueField;return e.map((function(e){if((e=(0,i.Cl)({},e)).visible=!!(0,h.Ht)([e],t,{keys:[r||"label",l||"value"],threshold:h.Ht.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=n.filterOptions(e.children,t);var o=e.children.filter((function(e){return e.visible})).length;e.visible=!!o}return e.visible&&(e.collapsed=!1),e}))},t.prototype.handleChange=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r,l,a,s,d,p,h,u,m,g,f,y,C,b,S;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.onChange,o=t.searchable,r=t.options,l=t.dispatchEvent,a=t.multiple,s=t.delimiter,d=t.valueField,p=t.selectedOptions,h=t.joinValues,u=t.extractValue,m=this.state,g=m.filteredOptions,f=m.allowSearch,y=o||f?g:r,C=(0,c.R2)(e,{multiple:a,delimiter:s,valueField:d,options:g}),b=a?null:C[0],a&&(o||f)&&p.length&&(p.forEach((function(e){var t=(0,v.cym)(g,(function(t){return t[d||"value"]===e[d||"value"]}));t||C.push(e)})),e=C.map((function(e){return u||h?e[d||"value"]:e})),h&&(e=e.join(s||","))),[4,l("change",(0,v.RKM)(this.props,{value:e,item:b,items:y,selectedItems:C}))];case 1:return(null==(S=i.sent())?void 0:S.prevented)||n&&n(e),[2]}}))}))},t.prototype.handleNodeClick=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r;return(0,i.YH)(this,(function(i){switch(i.label){case 0:return t=this.props,n=t.dispatchEvent,o=t.data,[4,n("itemClick",(0,v.ed2)(o,{item:e}))];case 1:return null==(r=i.sent())||r.prevented,[2]}}))}))},t.prototype.handleSearch=function(e){return(0,i.sH)(this,void 0,void 0,(function(){var t,n,o,r,l,a,s,d,p,h;return(0,i.YH)(this,(function(i){switch(i.label){case 0:if(t=this.props,n=t.searchApi,o=t.options,r=t.env,l=t.data,a=t.translate,s=[],!(0,v.Amo)(n))return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.fetcher(n,(0,v.ed2)(l,{term:e}))];case 2:if(!(d=i.sent()).ok)throw new Error(a(d.msg||"networkError"));if(p=d.data.options||d.data.items||d.data,!Array.isArray(p))throw new Error(a("Tree.invalidArray"));return s=p,[3,4];case 3:return h=i.sent(),r.isCancel(h)||!n.silent&&r.notify("error",h.message),[3,4];case 4:return[3,6];case 5:e&&(s=this.filterOptions(o,e)),i.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?s:o}),[2]}}))}))},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.validate=function(){var e=this.props,t=e.value,n=e.minLength,i=e.maxLength,o=e.delimiter,r=Array.isArray(t)?t:(t?String(t):"").split(o||",");return n&&r.length<n?"已选择数量低于设定的最小个数".concat(n,"，请选择更多的选项。"):i&&r.length>i?"已选择数量超出设定的最大个数".concat(i,"，请取消选择超出的选项。"):void 0},t.prototype.renderOptionItem=function(e,t){var n=this.props,o=n.menuTpl,r=n.render,l=n.data;return r("option/".concat(t.index),o,{data:(0,v.ed2)((0,v.ed2)(l,(0,i.Cl)({},t)),e)})},t.prototype.renderItemActions=function(e,t){var n=this.props,o=n.itemActions,r=n.data;return(0,n.render)("action/".concat(t.index),o||"",{data:(0,v.ed2)((0,v.ed2)(r,(0,i.Cl)({},t)),e)})},t.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,n=e.searchConfig,r=e.mobileUI,a=e.testIdBuilder;return o.createElement(u.Gd,(0,i.Cl)({className:p()("".concat(t,"TreeControl-searchbox"),null==n?void 0:n.className,{"is-sticky":null==n?void 0:n.sticky}),mini:!1,clearable:!0},l()(n,"className","sticky"),{onSearch:this.handleSearch,mobileUI:r,testIdBuilder:null==a?void 0:a.getChild("search")}))},t.prototype.render=function(){var e=this.props,t=e.className,n=e.treeContainerClassName,r=e.classPrefix,l=e.value,a=e.enableNodePath,s=e.pathSeparator,d=void 0===s?"/":s,h=e.disabled,c=e.joinValues,m=e.extractValue,g=e.delimiter,f=e.placeholder,y=e.options,C=e.multiple,b=e.valueField,S=e.initiallyOpen,O=e.unfoldedLevel,F=e.withChildren,w=e.onlyChildren,A=e.onlyLeaf,H=e.loading,I=e.hideRoot,R=e.rootLabel,T=e.autoCheckChildren,k=e.autoCancelParent,E=e.cascade,L=e.rootValue,N=e.showIcon,V=e.showRadio,j=e.showOutline,x=e.onAdd,P=e.creatable,D=e.createTip,B=e.addControls,U=e.onEdit,z=e.editable,M=e.editTip,_=e.editControls,Y=e.removable,G=e.removeTip,q=e.onDelete,K=e.rootCreatable,Q=e.rootCreateTip,W=e.labelField,X=e.iconField,$=e.deferField,J=e.nodePath,Z=e.deferLoad,ee=e.expandTreeOptions,te=e.translate,ne=e.data,ie=e.virtualThreshold,oe=e.itemHeight,re=e.loadingConfig,le=e.menuTpl,ae=e.enableDefaultIcon,se=e.searchable,de=e.searchConfig,pe=void 0===de?{}:de,he=e.heightAuto,ue=e.mobileUI,ce=e.testIdBuilder,ve=e.nodeBehavior,me=e.itemActions,ge=e.id,fe=e.wrapperCustomStyle,ye=e.themeCss,Ce=e.env,be=this.props.highlightTxt,Se=this.state,Oe=Se.filteredOptions,Fe=Se.keyword,we=Se.allowSearch,Ae=Se.virtualListHeight;(0,v.joH)(be)&&(be=(0,v.GvO)(be,ne));var He=o.createElement(u.PH,{classPrefix:r,onRef:this.domRef,labelField:W,valueField:b,iconField:X,deferField:$,disabled:h,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:c,extractValue:m,delimiter:g,placeholder:te(f),options:se||we?Oe:y,highlightTxt:se||we?Fe:be,multiple:C,initiallyOpen:S,unfoldedLevel:O,withChildren:F,onlyChildren:w,onlyLeaf:A,hideRoot:I,rootLabel:te(R),rootValue:L,showIcon:N,showRadio:V,showOutline:j,autoCheckChildren:T,autoCancelParent:k,cascade:E,foldedField:"collapsed",value:l||"",nodePath:J,enableNodePath:a,pathSeparator:d,selfDisabledAffectChildren:!1,onAdd:x,creatable:P,createTip:D,rootCreatable:K,rootCreateTip:Q,onEdit:U,editable:z,editTip:M,removable:Y,removeTip:G,onDelete:q,bultinCUD:!B&&!_,onDeferLoad:Z,onExpandTree:ee,virtualThreshold:ie,virtualHeight:(0,v.Roz)(Ae)>=0?(0,v.Roz)(Ae):void 0,itemHeight:(0,v.Roz)(oe)>0?(0,v.Roz)(oe):void 0,itemRender:le?this.renderOptionItem:void 0,enableDefaultIcon:ae,mobileUI:ue,nodeBehavior:ve,itemActionsRender:me?this.renderItemActions:void 0,actionClassName:p()((0,v.NH8)((0,i.Cl)((0,i.Cl)({},this.props),{name:"actionControlClassName",id:ge,themeCss:ye}))),testIdBuilder:null==ce?void 0:ce.getChild("tree")});return o.createElement(o.Fragment,null,o.createElement("div",(0,i.Cl)({ref:this.rootRef,className:p()("".concat(r,"TreeControl"),t,n,{"is-sticky":se&&(null==pe?void 0:pe.sticky),"h-auto":he})},null==ce?void 0:ce.getChild("control").getTestId()),o.createElement(u.y$,{size:"sm",key:"info",show:H,loadingConfig:re}),H?null:se?o.createElement(o.Fragment,null,this.renderSearch(),He):He),o.createElement(v.z4D,(0,i.Cl)({},this.props,{config:{wrapperCustomStyle:fe,id:ge,themeCss:ye,classNames:[{key:"actionControlClassName"}]},env:Ce})))},t.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",Promise)],t.prototype,"handleNodeClick",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"domRef",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[Object,Object]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"renderItemActions",null),(0,i.Cg)([v.d6t,(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"renderSearch",null),(0,i.Cg)([(0,m.E)(),(0,i.Sn)("design:type",Function),(0,i.Sn)("design:paramtypes",[]),(0,i.Sn)("design:returntype",void 0)],t.prototype,"render",null),t}(o.Component),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.C6)(t,e),(0,i.Cg)([(0,v.QqA)({type:"input-tree"})],t)}(g)}}]);