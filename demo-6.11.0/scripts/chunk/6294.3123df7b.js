"use strict";(self.webpackChunkamis_editor_demo=self.webpackChunkamis_editor_demo||[]).push([[6294],{16294:function(e,r,t){t.r(r),t.d(r,{MappingField:function(){return u},MappingFieldRenderer:function(){return c},Store:function(){return p}});var n,a=t(31635),i=t(96540),o=t(62758),s=t(71121),l=t(50346),p=o.KNR.named("MappingStore").props({fetching:!1,errorMsg:"",valueField:"value",map:l.gK.frozen({})}).actions((function(e){var r=(0,l.L3)((function(r,t,n){var i,s,l;return(0,a.YH)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),e.fetching=!0,[4,r.fetcher(t,n)];case 1:if(!(i=a.sent()).ok)throw new Error(i.msg||"fetch error");return s=(0,o.bqU)(i.data),e.setMap(Array.isArray(s.options)?s.options:Array.isArray(s.items)?s.items:Array.isArray(s.records)?s.records:s),[3,4];case 2:return l=a.sent(),e.errorMsg=l.message,[3,4];case 3:return e.fetching=!1,[7];case 4:return[2]}}))}));return{load:r,setMap:function(r){Array.isArray(r)&&(r=r.reduce((function(r,t){if(null==t)return r;if((0,o.Gvm)(t)){var n=Object.keys(t);1===n.length||2==n.length&&n.includes("$$id")?r[(n=n.filter((function(e){return"$$id"!==e})))[0]]=t[n[0]]:n.length>1&&(r[t[e.valueField]]=t)}return r}),{})),(0,o.Gvm)(r)&&(e.map=(0,a.Cl)({},r))}}})),u=(0,s.aH)((function(e){return p.create({id:(0,o.OsD)(),storeType:p.name},e.env)}))(((n=function(e){function r(r){var t=e.call(this,r)||this;return r.store.syncProps(r,void 0,["valueField","map"]),t}return(0,a.C6)(r,e),r.prototype.componentDidMount=function(){this.reload()},r.prototype.componentDidUpdate=function(e){var r=this.props,t=this.props,n=t.store,a=t.source,i=t.data;if(n.syncProps(r,e,a?["valueField"]:["valueField","map"]),(0,o.joH)(a)){var s=(0,o.GvO)(e.source,e.data,"| raw"),l=(0,o.GvO)(a,i,"| raw");s!==l&&n.setMap(l)}else(0,o.B92)(e.source,r.source,e.data,r.data)&&this.reload()},r.prototype.reload=function(){var e,r=this.props,t=r.source,n=r.data,a=r.env,i=this.props.store;if((0,o.joH)(t))i.setMap((0,o.GvO)(t,n,"| raw"));else if((0,o.Amo)(t,n)){var s=(0,o.UfW)(t,"get");s.cache=null!==(e=s.cache)&&void 0!==e?e:3e4,i.load(a,s,n)}},r.prototype.renderSingleValue=function(e,r,t){var n,a=this.props,o=a.className,s=a.style,l=a.placeholder,p=a.classnames,u=a.store,c=i.createElement("span",{className:"text-muted"},l),d=u.map,m=void 0,f=t?s:void 0;return void 0!==(e="string"==typeof e?e.trim():e)&&d&&void 0!==(m=null!==(n=this.renderValue(d,e))&&void 0!==n?n:!0===e&&d[1]?d[1]:!1===e&&d[0]?d[0]:d["*"])&&(c=this.renderViewValue(m,e)),i.createElement("span",{key:"map-".concat(r),className:p("MappingField",o),style:f},c)},r.prototype.renderViewValue=function(e,r){var t=this.props,n=t.render,i=t.itemSchema,s=t.renderViewValue,l=t.data,p=t.labelField,u=t.name;if(s)return s(e,r);if(!i){var c=e;return(0,o.Gvm)(e)&&(c=void 0===p||""===p?e.hasOwnProperty("type")?(0,a.Cl)({name:u},c):e.label:e[p||"label"]),(0,o.Gvm)(c)&&"tag"===c.type&&!(0,o.Gvm)(c.label)&&null!=c.label?n("mapping-tag",c,{value:null}):n("tpl",c)}return n("mappingItemSchema",i,(0,a.Cl)({data:(0,o.ed2)(l,(0,o.Gvm)(e)?e:{item:e})},"tag"===(null==i?void 0:i.type)?{value:null}:{}))},r.prototype.renderValue=function(e,r){var t=this.props.renderValue;return t?t(e,r):e[r]},r.prototype.render=function(){var e=this,r=this.props,t=r.style,n=r.defaultValue,a=r.data,s=(0,o.$_G)(this.props);return n&&(0,o.joH)(n)&&n===s&&(s=(0,o.GvO)(n,a,"| raw")),Array.isArray(s)?i.createElement("span",{style:t},s.map((function(r,t){return e.renderSingleValue(r,t)}))):this.renderSingleValue(s,0,!0)},r}(i.Component)).defaultProps={placeholder:"-",map:{"*":"通配值"}},n)),c=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return(0,a.C6)(r,e),r.prototype.render=function(){return i.createElement(u,(0,a.Cl)({},this.props))},(0,a.Cg)([(0,o.A49)({type:"mapping",alias:["map"],name:"mapping"})],r)}(i.Component)}}]);